<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CelloBot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <link rel="stylesheet" href="taskpane.css" />
</head>
<body>
  <div id="app">
    <header class="top-bar">
      <div class="logo-area">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 4h16v16H4V4z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 9h6v6H9z" fill="currentColor"/>
        </svg>
        <h1 class="app-title">CelloBot</h1>
      </div>
      <div class="header-actions">
        <button id="export-chat-btn" type="button" class="header-btn" aria-label="Export chat" title="Export chat">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="new-chat-btn" type="button" class="header-btn" aria-label="New chat" title="New chat">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </header>

    <div id="quick-tools" class="quick-tools">
      <div class="quick-tools-row">
        <button type="button" class="quick-tool-btn" data-skill="monthly-budget" title="Create a monthly budget template">Budget</button>
        <button type="button" class="quick-tool-btn" data-skill="expense-tracker" title="Create an expense tracker">Expenses</button>
        <button type="button" class="quick-tool-btn" data-skill="pivot-tables" title="Create a pivot table from selected data">Pivot</button>
        <button type="button" class="quick-tool-btn" data-skill="charts" title="Create a chart from selected data">Chart</button>
        <button type="button" class="quick-tool-btn" data-skill="financial-model" title="Build a simple financial model">Model</button>
        <button type="button" class="quick-tool-btn" data-skill="fix-errors" title="Diagnose and fix formula errors">Fix Errors</button>
      </div>
    </div>

    <main id="chat-messages" class="chat-area">
      <div id="welcome-screen" class="welcome-screen">
        <h2 class="welcome-title">How can I help with Excel today?</h2>
        <p class="welcome-subtitle">Ask for formulas, explain existing ones, or get analysis help.</p>
        <div class="suggestion-chips">
          <button type="button" class="chip" data-prompt="Write a VLOOKUP to find product prices from a table">Write a VLOOKUP</button>
          <button type="button" class="chip" data-prompt="Explain this formula in simple terms">Explain a formula</button>
          <button type="button" class="chip" data-prompt="Sum the values in column A from row 2 to row 100">Sum a range</button>
          <button type="button" class="chip" data-prompt="Create a COUNTIF to count cells greater than 50">Count with criteria</button>
        </div>
      </div>
      <div id="message-thread" class="message-thread"></div>
    </main>

    <div id="context-panel" class="context-panel hidden">
      <div class="context-panel-header">
        <h3>Pinned Context</h3>
        <button id="context-panel-close" type="button" class="header-btn" aria-label="Close">Ã—</button>
      </div>

      <div class="token-meter">
        <div class="token-meter-bar">
          <div id="token-meter-fill" class="token-meter-fill"></div>
        </div>
        <span id="token-meter-label" class="token-meter-label">0 tokens (0%)</span>
      </div>

      <div id="pinned-chips" class="pinned-chips"></div>

      <button id="capture-selection-btn" type="button" class="capture-btn">Capture Current Selection</button>

      <div id="sheet-list" class="sheet-list"></div>
    </div>

    <div id="change-tracker" class="change-tracker hidden">
      <span class="change-count">0 changes made</span>
      <button id="undo-all-btn" type="button" class="undo-btn" aria-label="Undo all changes">Undo All</button>
    </div>

    <div class="input-area">
      <div class="input-container">
        <button id="context-btn" type="button" class="context-btn" aria-label="Add context" title="Add context">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span id="context-badge" class="context-badge hidden">0</span>
        </button>
        <span id="context-indicator" class="context-indicator" aria-label="Current sheet and selection"></span>
        <select id="model-select" class="model-pill" aria-label="Select AI model">
          <option value="claude-sonnet">Sonnet 4.5</option>
          <option value="claude-opus">Opus 4.6</option>
          <option value="openai-4o">GPT-4o</option>
          <option value="openai-4o-mini">GPT-4o Mini</option>
        </select>
        <textarea id="message-input" placeholder="Ask for a formula or type =FORMULA to explain it..." rows="1"></textarea>
        <button id="send-btn" type="button" class="send-btn" aria-label="Send">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <script src="changeTracker.js"></script>
  <script src="toolExecutor.js"></script>
  <script src="taskpane.js"></script>
</body>
</html>
